import{_ as K}from"./B8jAESM1.js";import{_ as U}from"./YHbarISp.js";import{_ as W,f as X,k as Y,l as E,g as A,m as Z,n as ee,c as s,F as v,h as d,a,q as I,b as te,s as r,i as L,w as se,j as oe,o as t,t as D,v as F,d as z,p as ae,e as le}from"./DMHAXQVH.js";import{u as ne}from"./Da75yhFc.js";import{u as ce}from"./BoiVb1_4.js";const g=o=>(ae("data-v-80f282de"),o=o(),le(),o),re={key:0},de={class:"table mb-8"},ue={class:"text-left"},ie=g(()=>a("th",null,"관리",-1)),ye={key:0},he=["colspan"],_e=["width"],ke=["href"],ve=["href"],ge={class:"py-2 border-b",width:"10%"},fe={class:"flex flex-col"},pe=["onClick"],be=["onClick"],xe=["onClick"],me={key:1},we=["colspan"],$e=g(()=>a("div",{class:"text-center"},[a("span",{class:"text-sm"},"표시할 데이터가 없습니다.")],-1)),Ce=[$e],Re={class:"mt-3"},Ee={class:"footer-util"},Ie={key:1,class:"text-grayscale-400"},De={key:1,class:"text-center pt-4 pb-8 border-b border-b-grayscale-300"},qe=g(()=>a("span",{class:"text-sm text-grayscale-500"}," 데이터가 없습니다.",-1)),Ne=[qe],Oe={class:"floating-btn"},Qe={key:1,class:"error-message"},Te=g(()=>a("h6",null,"ERROR 404",-1)),Be=g(()=>a("span",null,"잘못된 접근입니다.",-1)),Se=g(()=>a("div",{class:"mt-4"},null,-1)),Ve=[Te,Be,Se],je={__name:"index",props:{col:{type:Object,default:null},addQuery:{type:Object,default:null}},async setup(o){let x,q;const N=X(),M=Y(),u=o,w=ne(),$=E(null),y=A(()=>{var l;return{...(l=u.col)==null?void 0:l.defaultQuery,...u.addQuery,...N.query}}),h=E(!1),O=async l=>{var k,p,i;(k=u.col)!=null&&k.key||(w.add({id:"not-found-col-key",title:"ERROR 404",description:"잘못된 접근입니다. 로그인한 계정이 있는 경우, 로그아웃합니다.",icon:"memory:alert-octagon",color:"red"}),M.push("/auth/login")),h.value=!1;const c=await $fetch(`/api/collection/${(p=u.col)==null?void 0:p.key}`,{query:l});return(i=y==null?void 0:y.value)!=null&&i.limit&&(c==null?void 0:c.length)<y.value.limit&&(h.value=!0),c},{data:m,pending:C,error:Ae,refresh:P}=([x,q]=Z(async()=>{var l;return ce(`${(l=u.col)==null?void 0:l.key}-items-admin`,async()=>{var c;await O({...(c=u.col)==null?void 0:c.defaultQuery,...u.addQuery,...N.query})})}),x=await x,q(),x),f=E([]),_=A(()=>[...m.value,...f.value]),G=async()=>{const l=_.value[_.value.length-1].id;$.value===l&&(h.value=!0),$.value=l;const c=await O({...y.value,startAfter:l});c&&(f.value=[...f.value,...c])};ee(()=>y.value,async(l,c)=>{f.value=[],$.value=null,h.value=!1,await P()});const H=async(l,c,k)=>{if(await window.confirm("삭제사히겠습니까?"))try{if(await $fetch(`/api/${l}/document`,{method:"DELETE",query:{id:c}})){w.add({id:`work-delete-${new Date().getTime()}`,title:"정상적으로 삭제했습니다.",icon:"memory:checkbox-marked"});const b=[...m.value,...f.value];b.splice(k,1),m.value=b}}catch(i){w.add({id:`${u.col.key}-delete-fail`,title:`ERROR ${i.statusCode}`,description:i.data.message||"문제가 발생하여 실패햇습니다.",icon:"memory:alert-octagon",color:"red"})}};return(l,c)=>{var b,Q,T,B,S,V,j;const k=oe("status-loading"),p=K,i=U;return t(),s("div",null,[(b=o.col)!=null&&b.key?(t(),s(v,{key:0},[(Q=d(_))!=null&&Q.length?(t(),s("section",re,[a("table",de,[a("thead",null,[a("tr",null,[(t(!0),s(v,null,I(o.col.list.key,(n,R)=>(t(),s("th",ue,D(n.text),1))),256)),ie])]),a("tbody",null,[d(C)?(t(),s("tr",ye,[a("td",{colspan:((T=o.col.list.key)==null?void 0:T.length)+1},[te(k)],8,he)])):r("",!0),(t(!0),s(v,null,I(d(_),(n,R)=>(t(),s("tr",{key:R},[(t(!0),s(v,null,I(o.col.list.key,(e,J)=>(t(),s("td",{key:J,width:e!=null&&e.width?`${e.width}%`:"auto"},[n[e.value]||n[e.value]!==""?(t(),s(v,{key:0},[e.type==="string"?(t(),s("p",{key:0,class:F(["truncate max-w-full px-3",e==null?void 0:e.addtionalClass])},D(n[e.value]),3)):e.type==="url"?(t(),s("a",{key:1,class:F(["link-item text-blue-400 underline mx-2 px-2",e==null?void 0:e.addtionalClass]),href:`https://seoro-malgm.studio/${e.url}/${n[e.value]}`,target:"_blank"},D(n[e.value]),11,ke)):e.type==="image"?(t(),L(p,{key:2,preset:"adminThumbnail",src:n[e.value]},null,8,["src"])):e.type==="file"?(t(),s("a",{key:3,href:n[e.value],target:"_blank",class:"link-item text-blue-400 underline mx-2 px-2"}," 미리보기 ",8,ve)):(t(),s(v,{key:4},[z(" - ")],64))],64)):r("",!0)],8,_e))),128)),a("td",ge,[a("div",fe,[o.col.removeable?(t(),s("button",{key:0,onClick:e=>H(o.col.key,n==null?void 0:n.id,R),class:"bg-red-600 text-grayscale-200 rounded-md mb-1 py-1"}," 삭제 ",8,pe)):r("",!0),o.col.editable?(t(),s("button",{key:1,class:"bg-orange-500 text-grayscale-200 rounded-md py-1",onClick:e=>l.$router.push({path:`/admin/${o.col.key}/write`,query:{id:n==null?void 0:n.id}})}," 수정 ",8,be)):r("",!0),o.col.preview?(t(),s("button",{key:2,class:"bg-orange-500 text-grayscale-200 rounded-md py-1",onClick:e=>l.$router.push({path:`/admin/${o.col.key}/${n.id}`})}," 상세보기 ",8,xe)):r("",!0)])])]))),128)),(B=d(_))!=null&&B.length?r("",!0):(t(),s("tr",me,[a("td",{colspan:((S=o.col.list.key)==null?void 0:S.length)+1},Ce,8,we)]))])]),a("section",Re,[a("nav",Ee,[!d(C)&&!d(h)?(t(),s("button",{key:0,onClick:c[0]||(c[0]=n=>G()),class:"inline-block border border-grayscale-800 rounded-full px-8 py-3 border-grayscale-800 hover:animate-wiggle hover:bg-spring-green-500 hover:text-grayscale-200 hover:border-spring-green-500"}," 더 불러오기 ")):r("",!0),!d(C)&&d(h)?(t(),s("span",Ie," End. ")):r("",!0)])])])):r("",!0),(V=d(_))!=null&&V.length?r("",!0):(t(),s("div",De,Ne)),a("div",Oe,[o.col.creatable?(t(),L(i,{key:0,class:"link-item",to:{path:`/admin/${o.col.key}/write`,query:{no:Number(((j=d(m)[0])==null?void 0:j.no)+1||0)}}},{default:se(()=>[z(" 새로 추가하기 ")]),_:1},8,["to"])):r("",!0)])],64)):(t(),s("div",Qe,Ve))])}}},Ge=W(je,[["__scopeId","data-v-80f282de"]]);export{Ge as default};
