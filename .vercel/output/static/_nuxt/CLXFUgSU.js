import{_ as j,j as h,l as S,s as w,o as c,c as m,a as d,t as x,n as q,v as R,b as $,F as C,i as D,f as T,g as b,x as E,w as I,r as N,y as F}from"./DKUbIslQ.js";import{_ as B}from"./DlVeFjkC.js";import{u as O}from"./BhHmZ4V8.js";import P from"./qzjNJ8tb.js";import{_ as L}from"./ClxLudO0.js";import{_ as V}from"./DwmXvu1b.js";import"./xY5XUOcG.js";import"./qsMMcMsd.js";const A={class:"input-group"},M={class:"input"},U={key:0,class:"input-title"},G={key:1,class:"input-desc"},z={key:2,class:"attached-image"},H=["src"],J={class:"utils"},K={key:1,class:"input-file"},Q=["required","autocomplete","id"],W=["for"],X={__name:"image",props:{id:{type:String,default:"input-file-obj"},title:{type:String,default:null},desc:{type:String,default:null},inputType:{type:String,default:null},form:{type:Object,required:!0,default:null},bind:{type:String,required:!0,default:null},path:{type:String,required:!0,default:"image"},required:{type:Boolean,default:null},autocomplete:{type:String,default:null}},emits:{input:e=>!0},setup(e,{emit:i}){const n=e,s=i,o=h(null),p=h(null);S(()=>o.value,(l,u)=>{s("input",l)}),S(()=>n.form[n.bind],(l,u)=>{o.value=l,s("input",l)}),w(()=>{n.form[n.bind]&&(o.value=n.form[n.bind])});const _=O(),a=h(!1),f=async l=>{const u=l.target.files[0];if(u){a.value=!0;try{const r=u==null?void 0:u.type.split("/").at(-1),t=`${n.path}_${new Date().getTime()}.${r}`,y=new FormData;y.append("file",u);const v=await $fetch("/api/storage/create",{method:"POST",body:y,query:{path:n.path,fileName:t,type:u.type}});v&&(o.value=v.url,p.value=v.name)}catch(r){_.add({id:"upload-fail",title:`ERROR ${r.statusCode}`,description:r.data.message||"에러가 발생하였습니다.",icon:"memory:alert-octagon",color:"red"})}finally{a.value=!1,l.target.value=""}}},k=async l=>{l!=null&&l.name&&await $fetch("/api/storage/delete",{method:"DELETE",query:{path:n.path,fileName:l.name}}),a.value=!1,o.value=null,p.value=null};return(l,u)=>{const r=P,t=L;return c(),m("div",A,[d("div",M,[e.title?(c(),m("span",U,x(e.title),1)):q("",!0),e.desc?(c(),m("p",G,x(e.desc),1)):q("",!0),o.value?(c(),m("figure",z,[d("img",{src:o.value,alt:"현재 업로드된 이미지"},null,8,H),d("div",J,[d("button",{onClick:u[0]||(u[0]=R(y=>k(p.value),["prevent"])),class:"btn-remove"},[$(r,{name:"memory:trash"})])])])):(c(),m(C,{key:3},[a.value?(c(),D(t,{key:0})):(c(),m("div",K,[d("input",{type:"file",onChange:f,required:e.required,autocomplete:e.autocomplete,id:e.id,accept:".png, .jpg, .jpeg"},null,40,Q),d("label",{for:e.id,class:"input-label"}," 이미지 업로드 ",8,W)]))],64))])])}}},Y=j(X,[["__scopeId","data-v-67670b5e"]]),Z={id:"form-sponsor"},tt={class:"mb-4 w-full md:w-3/12 lg:w-2/12"},et=d("div",{class:"mb-4"},null,-1),ot={__name:"sponsors",props:{col:{type:Object,default:null},id:{type:String,default:null},form:{type:Object,default:null}},setup(e,{emit:i}){h(!1);const n=T();return b(()=>{var s;return(s=n.query)==null?void 0:s.no}),b(()=>{var s;return(s=n.query)==null?void 0:s.id}),(s,o)=>{const p=Y,_=V;return c(),m("div",Z,[d("div",tt,[$(p,{form:e.form,bind:"logo",path:"sponsors",title:"로고",onInput:o[0]||(o[0]=a=>s.$emit("input",["logo",a]))},null,8,["form"])]),et,$(_,{class:"mb-6",form:e.form,bind:"name",title:"이름",onInput:o[1]||(o[1]=a=>s.$emit("input",["name",a]))},null,8,["form"])])}}},nt={key:0,class:"pt-4 border-t"},at=d("h6",{class:"text-2xl mb-3"},"form 데이터 미리보기 :",-1),st={class:"block w-full overflow-auto bg-grayscale-300 border border-grayscale-800 text-wrap p-6 rounded-xl"},ft={__name:"write",props:{col:{type:Object,default:null}},setup(e){const i=e,n=T(),s=E(),o=O(),p={sponsors:ot},_=b(()=>p[i.col.key]);w(()=>{(!i.col.key||!_.value)&&(window.alert("잘못된 접근입니다."),s.go(-1))});const a=h({}),f=b(()=>{var r;return(r=n==null?void 0:n.query)==null?void 0:r.id});w(()=>{f.value&&k(f.value)});const k=async r=>{const t=await $fetch(`/api/${i.col.key}/document`,{method:"GET",params:{col:i.col.key},query:{id:r}});t&&(a.value={...t})},l=async r=>{try{await $fetch(`/api/${i.col.key}/document`,{method:"POST",body:{...a.value,createdAt:new Date().toLocaleString()}})&&(s.push(`/admin/${i.col.key}`),o.add({id:`work-added-${new Date().getTime()}`,title:"정상적으로 추가되었습니다..",icon:"memory:checkbox-marked"}))}catch(t){o.add({id:`${i.col.key}-write-fail`,title:`ERROR ${t.statusCode}`,description:t.data.message||"업로드중에 문제가 발생하여 실패햇습니다.",icon:"memory:alert-octagon",color:"red"})}},u=async r=>{try{await $fetch(`/api/${i.col.key}/document`,{method:"PUT",body:{...a.value},query:{id:f.value}})&&(s.push(`/admin/${i.col.key}`),o.add({id:`work-added-${new Date().getTime()}`,title:"정상적으로 수정되었습니다",icon:"memory:checkbox-marked"}))}catch(t){o.add({id:`${i.col.key}-update-fail`,title:`ERROR ${t.statusCode}`,description:t.data.message||"업데이트중에 문제가 발생하여 실패햇습니다.",icon:"memory:alert-octagon",color:"red"})}};return(r,t)=>{const y=F,v=B;return c(),m("div",null,[$(y),$(v,{onSubmit:t[2]||(t[2]=R(g=>f.value?u():l(),["prevent"]))},{default:I(()=>[(c(),D(N(_.value),{col:e.col,id:f.value,form:a.value,onInput:t[0]||(t[0]=g=>a.value[g[0]]=g[1]),onInit:t[1]||(t[1]=g=>a.value=g)},null,40,["col","id","form"])),e.col.formPreview?(c(),m("div",nt,[at,d("pre",st,"form: "+x(a.value)+`
      `,1)])):q("",!0)]),_:1})])}}};export{ft as default};
