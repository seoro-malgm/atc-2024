import{f as h,k as x,g as u,x as p,l as R,c as y,b as f,w as C,y as D,o as i,i as T,r as B,a as k,t as E,s as F,z as N}from"./jXR-_GK-.js";import{_ as O}from"./BLHth5Ef.js";import{u as S}from"./BWil-vM0.js";const q={key:0,class:"pt-4 border-t"},I=k("h6",{class:"text-2xl mb-3"},"form 데이터 미리보기 :",-1),P={class:"block w-full overflow-auto bg-grayscale-300 border border-grayscale-800 text-wrap p-6 rounded-xl"},j={__name:"write",props:{col:{type:Object,default:null}},setup(n){const o=n,d=h(),l=x(),c=S(),w={works:FormWorks,blog:FormBlog,client:FormClient,estimates:FormEstimates},m=u(()=>w[o.col.key]);p(()=>{(!o.col.key||!m.value)&&(window.alert("잘못된 접근입니다."),l.go(-1))});const t=R({}),r=u(()=>{var a;return(a=d==null?void 0:d.query)==null?void 0:a.id});p(()=>{r.value&&v(r.value)});const v=async a=>{const e=await $fetch(`/api/${o.col.key}/document`,{method:"GET",params:{col:o.col.key},query:{id:a}});e&&(t.value={...e})},_=async a=>{try{await $fetch(`/api/${o.col.key}/document`,{method:"POST",body:{...t.value,createdAt:new Date().toLocaleString(),viewer:0}})&&(l.push(`/admin/${o.col.key}`),c.add({id:`work-added-${new Date().getTime()}`,title:"정상적으로 추가되었습니다..",icon:"memory:checkbox-marked"}))}catch(e){c.add({id:`${o.col.key}-write-fail`,title:`ERROR ${e.statusCode}`,description:e.data.message||"업로드중에 문제가 발생하여 실패햇습니다.",icon:"memory:alert-octagon",color:"red"})}},g=async a=>{try{await $fetch(`/api/${o.col.key}/document`,{method:"PUT",body:{...t.value},query:{id:r.value}})&&(l.push(`/admin/${o.col.key}`),c.add({id:`work-added-${new Date().getTime()}`,title:"정상적으로 수정되었습니다",icon:"memory:checkbox-marked"}))}catch(e){c.add({id:`${o.col.key}-update-fail`,title:`ERROR ${e.statusCode}`,description:e.data.message||"업데이트중에 문제가 발생하여 실패햇습니다.",icon:"memory:alert-octagon",color:"red"})}};return(a,e)=>{const b=N,$=O;return i(),y("div",null,[f(b),f($,{onSubmit:e[2]||(e[2]=D(s=>r.value?g():_(),["prevent"]))},{default:C(()=>[(i(),T(B(m.value),{col:n.col,id:r.value,form:t.value,onInput:e[0]||(e[0]=s=>t.value[s[0]]=s[1]),onInit:e[1]||(e[1]=s=>t.value=s)},null,40,["col","id","form"])),n.col.formPreview?(i(),y("div",q,[I,k("pre",P,"form: "+E(t.value)+`
      `,1)])):F("",!0)]),_:1})])}}};export{j as default};
